---
title: '`r paste0("ALS: Data Validation Report (", gsub(".*/", "", params$zip_path), ")")`'
date: "`r Sys.Date()`"
output:
  html_document:
    css: style.css
params:
  zip_path: "data/R2103464.zip"
---

```{r setup, echo = FALSE, message=FALSE}
# The majority of calculations are done here to make the info available on
# the "Summary" Tab.

# R Setup
rmd_setup()
# Extract ALS zip-file contents
source(file = "zip_contents.R", local = TRUE)
# Check that there are no duplicate rows
source(file = "distinct_rows.R", local = TRUE)
# Check that the data file matches the ALS schema
source(file = "schema.R", local = TRUE)
# Check that the report sites match expected sites.
source(file = "sites.R", local = TRUE)
# Check that the report values match expected values.
source(file = "expected_values.R", local = TRUE)
```

# Results {.tabset}

## Summary

__Goal:__ Summary of data validation results.
/  

__Issues:__

* __EDP Error Summary:__ `r get_als_error_message(als)`
* __Distinct Rows Check:__ `r print_n_fail(agent_drows)`
* __Schema Check:__ `r print_n_fail(agent_schema)`
* __Site Check:__
  + __Field:__ `r print_n_fail(agent_expected_field_sites)`
  + __Lab:__ `r print_n_fail(agent_expected_lab_sites)`
* __Value Check:__ `r print_n_fail(agent_expected_values)`

```{r scan-overview}
ALS_Results <- als$result
  pointblank::scan_data(
    tbl = ALS_Results,
    sections = c("overview"),
    navbar = FALSE
  )
rm("ALS_Results")
```

## EDP Error Summary (ALS)

__*The content below was provided by ALS*__

```{r edp-als, results='asis'}
# Print out the HTM file
# results=`asis` will render this as HTML when knitting
if (!is.null(als$htm)) {
  cat(als$htm)
} else {
  # Provide a message if no HTM file found
  cat(rep("/n", 3), "No HTM file provided.")
}

```

## Distinct Rows Check

__Goal:__ Identify if any rows in the provided data table are duplicated.
/  
```{r distinct-rows}
agent_drows
```

## Schema Check

__Goal:__ Identify if the data table provided meets the expected data schema, which represents a check on the name, order, and data type (e.g., character, numeric, integer) of the supplied columns.

```{r schema-check}
agent_schema
```

## Site Check

### Expected Field Sites 

```{r expected-field-sites}
agent_expected_field_sites 
```

### Expected Lab Sites 

```{r expected-lab-sites}
agent_expected_lab_sites 
```

## Value Check

```{r expected-values-check}
agent_expected_values
```

## Data Provided

```{r standard-dt-test-result, eval=FALSE}
validator::standard_dt(als$result)
```


```{r standard-dt-sample, eval=FALSE}
validator::standard_dt(x = als$Sample_v3.txt)
```

```{r standard-dt-batch, eval=FALSE}
validator::standard_dt(x = als$Batch_v3.txt)
```

```{r scan-variables, eval=FALSE}
als$result %>% 
  pointblank::scan_data(
    sections = c("variables"),
    navbar = FALSE
  )
```

## Help

The majority of this report makes use of the R-package, [__pointblank__](https://rich-iannone.github.io/pointblank/). __pointblank__ provides tools for validating data. Data validation refers to the act of verifying that the data meets expected requirements. For example, __pointblank__ can verify that all of the expected columns are present and represent the expected data type (e.g., character, integer, logical, etc.). In this report, the results of the validation process are generally reported in tables generated by the __pointblank__ function `interogate()`. The figure below describes how to interpret these tables.

![This image provides a description of how to interprate the tables produced by the pointblank R-package. This image is a direct copy of the image provided in the pointblank 'README.md' file. Richard Iannone (2020). pointblank: Validation of Local and Remote Data Tables. R package version 0.4.0. https://github.com/rich-iannone/pointblank/blob/master/README.md](images/agent_report.png)


__Citation__

Richard Iannone (2020). pointblank: Validation of Local and Remote Data Tables. R
  package version 0.4.0. https://CRAN.R-project.org/package=pointblank



